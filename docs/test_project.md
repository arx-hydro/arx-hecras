# Test Project: small_project_01

## Overview

A small 2D unsteady flow HEC-RAS model used for integration testing. Located in `test_projects/`.

- **CRS**: EPSG:32640 (WGS 84 / UTM zone 40N)
- **Region**: UAE (Al Ain area)
- **HEC-RAS version**: 6.6
- **Geometry**: `g02` ("geometry_01") — 2D flow area with ~1095 mesh cells
- **Plans**: 4 plans (`p01`–`p04`), each using different flow hydrographs from `100yCC_2024.dss`
- **Terrain**: `existing_01` — clipped to model extent + 200m buffer (1,950 x 1,500 px at 1m)

## File Inventory

### Tracked source files (committed to git)

| File | Purpose |
|------|---------|
| `small_project_01.prj` | Project file — references plans, geometry, flows |
| `small_project_01.g02` | Geometry definition (2D flow area perimeter, mesh settings) |
| `small_project_01.g02.hdf` | Geometry HDF (2D mesh, cell elevations from terrain) |
| `small_project_01.p01–p04` | Plan definitions (simulation parameters, time steps) |
| `small_project_01.u01–u04` | Unsteady flow definitions (boundary conditions, hydrographs) |
| `small_project_01.rasmap` | RAS Mapper configuration (layer visibility, symbology) |
| `100yCC_2024.dss` | Input DSS file (HEC-HMS hydrographs, shared by all plans) |
| `00_projection/32640.prj` | ESRI projection file for UTM zone 40N |
| `Features/Profile Lines.*` | Shapefile for cross-section profile output |
| `Terrain/existing_01/source.tif` | Clipped source raster (DEFLATE, ~7 MB) |
| `Terrain/existing_01/existing_01.hdf` | HEC-RAS terrain HDF (built from source.tif) |
| `Terrain/existing_01/existing_01.vrt` | GDAL VRT referencing the generated terrain TIF |
| `Terrain/existing_01/MergedInputs.vrt` | HEC-RAS build intermediate (references source.tif) |

### Runtime output files (gitignored)

These are regenerated by running HEC-RAS simulations:

| Pattern | Purpose |
|---------|---------|
| `*.p##.hdf` | Plan results (depth, velocity, WSE per timestep) |
| `*.u##.hdf` | Unsteady flow results |
| `*.b##` | Boundary condition data |
| `*.bco##` | Boundary condition output |
| `*.ic.o##` | Initial condition output |
| `*.x##` | Cross-section output |
| `*.dss` (output) | Output DSS file (`small_project_01.dss`) |
| `*.dsc.h5` | DSS companion files |
| `*.computeMsgs.txt` | Computation log messages |
| `*.rasmap.backup` | RAS Mapper backup |
| `*.source.tif` | HEC-RAS backup of terrain input |
| `systemInfoEncoded.txt` | System info snapshot |

## Terrain Preparation

The original terrain raster was 145 MB (10,544 x 6,573 px) — far too large for the model area. It was clipped using GDAL:

```bash
PROJ_LIB="C:/OSGeo4W/share/proj" gdal_translate \
  -projwin 448150 2692500 450100 2691000 \
  -a_srs EPSG:32640 -a_nodata -9999 \
  -co COMPRESS=DEFLATE -co PREDICTOR=2 -co TILED=YES \
  original.tif test_projects/Terrain/existing_01/source.tif
```

**Important**: The input TIF must have a different filename from `existing_01.tif` (e.g., `source.tif`) because HEC-RAS's terrain builder deletes the output filename before creating it. If input and output share the same name, the VRT source disappears and the build fails.

After placing `source.tif`, build the terrain in HEC-RAS:
1. RAS Mapper → Terrains → New Terrain → select `source.tif`
2. This creates `existing_01.tif`, `existing_01.hdf`, `existing_01.vrt`, and `MergedInputs.vrt`
3. The geometry must then be recomputed to sample cell elevations from the new terrain

## Git Ignore Strategy

The `.gitignore` uses glob patterns to exclude all HEC-RAS output, then `!` overrides to re-include specific source files:

```gitignore
# Excludes all HDF, DSS, boundary files, etc.
*.hdf
*.dss
*.b[0-9][0-9]
# ...

# Re-includes specific source files
!test_projects/small_project_01.g02.hdf
!test_projects/Terrain/existing_01/existing_01.hdf
!test_projects/100yCC_2024.dss
```

## Running the Model

From the CLI:
```bash
python -m hecras_runner test_projects/small_project_01.prj --all
```

Or run a single plan:
```bash
python -m hecras_runner test_projects/small_project_01.prj --plans plan_01
```
