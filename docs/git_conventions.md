# Git Conventions

## Branch Strategy

- `main` — primary branch, all work merged here
- `backup-main` tag — preserves original messy history before cleanup

## What Gets Tracked

### Always track
- Python source code (`src/`, `tests/`)
- HEC-RAS project definition files (`.prj`, `.p##`, `.g##`, `.u##`)
- Geometry HDF (`.g##.hdf`) — contains 2D mesh, expensive to regenerate
- Terrain HDF (`existing_01.hdf`) — built from source TIF by HEC-RAS
- Terrain source raster (`source.tif`) — the clipped input for terrain building
- Input DSS files (`100yCC_2024.dss`) — external hydrologic input
- RAS Mapper config (`.rasmap`)
- Projection files, shapefiles, VRT files

### Never track (gitignored)
- Plan result HDF (`.p##.hdf`) — regenerated by running simulations
- Unsteady flow HDF (`.u##.hdf`) — regenerated
- Boundary/output files (`.b##`, `.bco##`, `.ic.o##`, `.x##`)
- Output DSS files
- DSS companion files (`.dsc.h5`)
- Compute messages, rasmap backups, system info
- HEC-RAS terrain input backups (`*.source.tif`)

### Gitignore pattern

The `.gitignore` broadly excludes HEC-RAS output via glob patterns, then uses `!` negation overrides to re-include specific tracked source files:

```gitignore
*.hdf                                           # Exclude all HDF
!test_projects/small_project_01.g02.hdf         # But track geometry
!test_projects/Terrain/existing_01/existing_01.hdf  # And terrain
```

## Gotchas

### Case-insensitive gitignore matching (Windows)
With `core.ignoreCase=true`, a pattern like `HECRAS_*/` can accidentally match `hecras_runner/`. Always anchor patterns to the repo root with `/` prefix: `/HECRAS_*/`.

### Removing previously tracked files
Files committed before gitignore rules were added stay tracked even after the rule is added. Use `git rm --cached <file>` to untrack without deleting from disk.

### HEC-RAS modifies tracked files
Running simulations modifies `.rasmap` (adds result layers) and `.g##.hdf` (if terrain changes). These are legitimate changes that should be committed after verified runs. Boundary files (`.b##`) are also modified with temp directory paths — these are gitignored to avoid perpetually dirty status.
